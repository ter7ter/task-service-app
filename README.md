# Приложение для Ремонтного Сервиса

Это приложение на базе Laravel для управления заявками на ремонт. Приложение полностью контейнеризировано с использованием Docker.

## Требования

- Docker
- Docker Compose

## Быстрый старт

Чтобы запустить проект в первый раз, склонируйте репозиторий и выполните следующую команду:

```bash
docker-compose up -d --build
```

Эта команда выполнит следующие действия:
1.  Соберет необходимые Docker-образы.
2.  Создаст файл `.env` из `.env.example`, если он отсутствует.
3.  Установит все зависимости `composer`.
4.  Сгенерирует ключ приложения (`APP_KEY`).
5.  Создаст основную (`laravel`) и тестовую (`laravel_test`) базы данных, если они не существуют.
6.  Выполнит миграции базы данных.
7.  Запустит сиды для создания первоначальных пользователей (только если база данных пуста).
8.  Запустит все сервисы (`nginx`, `php`, `mysql`, `phpmyadmin`).

После завершения команды приложение будет доступно по адресу [http://localhost:8000](http://localhost:8000).

## Сервисы

- **Приложение**: [http://localhost:8000](http://localhost:8000)
- **phpMyAdmin**: [http://localhost:8081](http://localhost:8081)
  - **Имя пользователя**: `root`
  - **Пароль**: `root_password`

## Тестовые пользователи

База данных наполняется следующими пользователями. Вы можете использовать их для входа в систему.

| Роль        | Email                  | Пароль     |
|-------------|------------------------|------------|
| Диспетчер   | `dispatcher@example.com` | `password` |
| Мастер      | `master@example.com`     | `password` |
| Мастер      | `master2@example.com`     | `password` |

## Разработка

### Запуск тестов

Для запуска автоматических тестов используйте следующий скрипт `composer`. Эта команда выполнит тесты на отдельной, выделенной тестовой базе данных (`laravel_test`), не затрагивая ваши основные данные.

```bash
composer test
```

### Скрипт для проверки "состояния гонки"

Проект включает скрипт для проверки обработки состояния гонки, когда два мастера пытаются одновременно взять одну и ту же заявку. Чтобы запустить его, выполните следующую команду:

```bash
docker-compose exec php /var/www/html/race_test.sh
```

Успешный запуск выведет сообщение "Race test PASSED", указывающее, что один запрос прошел успешно, а другой был корректно обработан как конфликт параллелизма.
